CREATE TABLE IF NOT EXISTS USERS (
  USER_ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  EMAIL     VARCHAR(50) UNIQUE NOT NULL,
  LOGIN     VARCHAR(50) UNIQUE NOT NULL,
  USER_NAME VARCHAR(50),
  BIRTHDAY  DATE
);

CREATE TABLE IF NOT EXISTS STATUSES (
  STATUS_ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  STATUS_NAME VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS FRIENDSHIPS (
  USER_ID   INTEGER NOT NULL,
  FRIEND_ID INTEGER NOT NULL,
  STATUS_ID INTEGER NOT NULL,
  PRIMARY KEY (USER_ID, FRIEND_ID, STATUS_ID)
);
ALTER TABLE FRIENDSHIPS ADD CONSTRAINT FK_USER_USERS      FOREIGN KEY (USER_ID)   REFERENCES USERS (USER_ID);
ALTER TABLE FRIENDSHIPS ADD CONSTRAINT FK_FRIEND_USERS    FOREIGN KEY (FRIEND_ID) REFERENCES USERS (USER_ID);
ALTER TABLE FRIENDSHIPS ADD CONSTRAINT FK_STATUS_STATUSES FOREIGN KEY (STATUS_ID) REFERENCES STATUSES (STATUS_ID);

CREATE TABLE IF NOT EXISTS MPAS (
  MPA_ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  MPA_NAME VARCHAR(5) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS FILMS (
  FILM_ID      INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  FILM_NAME    VARCHAR(50) UNIQUE NOT NULL,
  DESCRIPTION  VARCHAR(200) NOT NULL,
  RELEASE_DATE DATE,
  DURATION     INTEGER,
  MPA_ID       INTEGER NOT NULL
);
ALTER TABLE FILMS ADD CONSTRAINT FK_FILMS_MPAS FOREIGN KEY (MPA_ID) REFERENCES MPAS (MPA_ID);

CREATE TABLE IF NOT EXISTS GENRES (
  GENRE_ID   INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  GENRE_NAME VARCHAR(20) UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS FILM_GENRES (
  FILM_ID  INTEGER NOT NULL,
  GENRE_ID INTEGER NOT NULL,
  PRIMARY KEY (FILM_ID, GENRE_ID)
);
ALTER TABLE FILM_GENRES ADD CONSTRAINT FK_FG_FILMS   FOREIGN KEY (FILM_ID)  REFERENCES FILMS (FILM_ID);
ALTER TABLE FILM_GENRES ADD CONSTRAINT FK_FG_GENRES  FOREIGN KEY (GENRE_ID) REFERENCES GENRES (GENRE_ID);

CREATE TABLE IF NOT EXISTS FILM_LIKES (
  FILM_ID INTEGER NOT NULL,
  USER_ID INTEGER NOT NULL,
  PRIMARY KEY (FILM_ID, USER_ID)
);
ALTER TABLE FILM_LIKES ADD CONSTRAINT FK_FL_FILMS FOREIGN KEY (FILM_ID) REFERENCES FILMS (FILM_ID);
ALTER TABLE FILM_LIKES ADD CONSTRAINT FK_FL_USERS FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID);